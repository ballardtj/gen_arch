---
title: "R Notebook"
output:
  html_document:
    df_print: paged
---

Model description:

* Hierarchical
* Weight parameters normally distributed, non-centered.
* Gradient parameters beta distributed, with alpha pushed away from 0 and 1 with alpha = 0.001 + 0.998*alpha_raw.

Run details: 

* Chains: 8
* Burnin: 4000
* Post-burnin: 10000
* Thinning: 10
* Total samples: 8000

Current issues with model:

1 Somewhat low ESS for alpha parameters. Likely due to the fact that allowable values 0 and 1 produce NAs. Next step is to run model with lower bound of 0.0001 and upper bound of 0.9999 to avoid NAs.
2 Hyper parms on gradients parameters are highly correlated. Worth running a model where gradient parms are normals with explicit truncation. Reparamterizing from beta to normal could help with this, as the correlation seems to only happen when gradients are betas.

# Observed Decisions

## Approach Condition

```{r,echo=FALSE,include=FALSE}
library(rstan)
library(coda)

hypers=c('w1_mean','w1_sd','w2_mean','w2_sd','w3_mean','w3_sd',
         'delta_a','delta_b','tau_a','tau_b','alpha_a','alpha_b')

load("data/derived/ap_obs_fit.RData")
```

### RStan output

```{r,echo=FALSE}
smrystan = summary(fit)
smrystan[[1]][hypers,]
```

### Coda output

Effective sample size

```{r,echo=FALSE}
stan2coda <- function(fit) {
  mcmc.list(lapply(1:ncol(fit), function(x) mcmc(as.array(fit)[,x,])))
}
effectiveSize(stan2coda(fit))[hypers]
```

Gelman's Rhat

```{r,echo=FALSE}
gelman.diag(stan2coda(fit))[[1]][hypers,]
```

### Plots

```{r,echo=FALSE}
rstan::traceplot(fit,par=hypers)
pairs(fit,pars=hypers)
```

## Avoidance Condition

```{r,echo=FALSE}
load("data/derived/av_obs_fit.RData")
```

### RStan output

```{r,echo=FALSE}
smrystan = summary(fit)
smrystan[[1]][hypers,]
```

### Coda output

Effective sample size
```{r,echo=FALSE}
effectiveSize(stan2coda(fit))[hypers]
```

Gelman's Rhat

```{r,echo=FALSE}
gelman.diag(stan2coda(fit))[[1]][hypers,]
```

### Plots

```{r,echo=FALSE}
rstan::traceplot(fit,par=hypers)
pairs(fit,pars=hypers)
```
